const threeNotes = 
{
    "score-partwise": {
        "$version": "3.1",
        "part-list": {
            "score-part": [
                {
                    "part-name": "Trumpet",
                    "voiceMapping": {
                        "0": [
                            0
                        ]
                    },
                    "staffMapping": [
                        {
                            "mainVoiceIdx": 0,
                            "voices": [
                                0
                            ],
                            "staffUuid": "55c57734-7ee9-2308-bd98-252db0f2a6e7"
                        }
                    ],
                    "voiceIdxToUuidMapping": {
                        "0": "fdc36069-82ee-b5db-60e3-543faf0ba49a"
                    },
                    "voiceUuidToIdxMapping": {
                        "fdc36069-82ee-b5db-60e3-543faf0ba49a": 0
                    },
                    "part-abbreviation": "Tpt.",
                    "score-instrument": {
                        "instrument-name": "Trumpet",
                        "$id": "P1-I1"
                    },
                    "midi-instrument": {
                        "midi-program": 257,
                        "volume": "100",
                        "$id": "P1-I1",
                        "midi-channel": "1"
                    },
                    "$id": "P1",
                    "uuid": "6aa64ca4-9919-c2e5-9d0a-78dde542ddc2"
                }
            ]
        },
        "measure-list": {
            "score-measure": [
                {
                    "uuid": "6a24e9a2-f8fa-ee43-b9c6-725681665b80"
                }
            ]
        },
        "part": [
            {
                "measure": [
                    {
                        "note": [
                            {
                                "staff": "1",
                                "voice": "1",
                                "duration": "4",
                                "pitch": {
                                    "octave": "5",
                                    "step": "E"
                                },
                                "type": "whole"
                            }
                        ],
                        "harmony": [],
                        "$number": "1",
                        "barline": {
                            "$location": "right",
                            "bar-style": "light-heavy",
                            "$adagio-location": {
                                "dpq": 1,
                                "timePos": 4
                            },
                            "noteBefore": 0
                        },
                        "attributes": [
                            {
                                "divisions": "1",
                                "time": {
                                    "beats": "4",
                                    "beat-type": "4"
                                },
                                "clef": {
                                    "sign": "G",
                                    "line": "2"
                                },
                                "key": {
                                    "fifths": "2"
                                },
                                "transpose": {
                                    "chromatic": "-2",
                                    "diatonic": "-1"
                                },
                                "staff-details": {
                                    "staff-lines": "5"
                                },
                                "$adagio-time": {
                                    "beats": "4",
                                    "beat-type": "4"
                                },
                                "noteBefore": -1,
                                "$adagio-location": {
                                    "timePos": 0,
                                    "dpq": 1
                                }
                            }
                        ],
                        "sound": [
                            {
                                "$adagio-swing": {
                                    "swing": false
                                },
                                "noteBefore": -1,
                                "$adagio-location": {
                                    "timePos": 0,
                                    "dpq": 1
                                }
                            },
                            {
                                "$tempo": "80",
                                "noteBefore": -1,
                                "$adagio-location": {
                                    "timePos": 0,
                                    "dpq": 1
                                }
                            }
                        ],
                        "direction": [
                            {
                                "$placement": "above",
                                "staff": "1",
                                "$adagio-location": {
                                    "timePos": 0
                                },
                                "direction-type": {
                                    "metronome": {
                                        "per-minute": "80",
                                        "beat-unit": "quarter"
                                    }
                                },
                                "noteBefore": -1,
                                "$adagio-isFirst": true
                            }
                        ],
                        "$adagio-beatsList": [
                            1,
                            1,
                            1,
                            1
                        ],
                        "$adagio-restsInsideBeams": false
                    },
                    {
                        "note": [
                            {
                                "staff": "1",
                                "voice": "1",
                                "duration": "4",
                                "pitch": {
                                    "octave": "2",
                                    "step": "F"
                                },
                                "type": "whole"
                            }
                        ]
                    },
                    {
                        "note": [
                            {
                                "staff": "1",
                                "voice": "1",
                                "duration": "4",
                                "pitch": {
                                    "octave": "3",
                                    "step": "A"
                                },
                                "type": "whole"
                            }
                        ]
                    }
                ],
                "$id": "P1",
                "uuid": "6aa64ca4-9919-c2e5-9d0a-78dde542ddc2"
            }
        ],
        "defaults": {
            "scaling": {
                "millimeters": "7",
                "tenths": "40"
            },
            "page-layout": {
                "page-height": "1596.5714285714287",
                "page-width": "1233.7142857142858",
                "page-margins": {
                    "$type": "both",
                    "top-margin": "38.857142857142854",
                    "bottom-margin": "38.857142857142854",
                    "left-margin": "38.857142857142854",
                    "right-margin": "38.857142857142854"
                }
            },
            "system-layout": {
                "system-distance": "115.2"
            },
            "staff-layout": {
                "staff-distance": "72.57142857142857"
            },
            "$adagio-measureNumberingStart": 1,
            "word-font": {
                "$font-family": "Century Schoolbook L"
            }
        },
        "$adagio-formatVersion": 60,
        "credit": [
            {
                "credit-type": "title",
                "credit-words": "one note - E5 Half"
            }
        ],
        "work": {
            "work-title": "one note - E5 Half"
        },
        "identification": {
            "encoding": {
                "software": "Flat",
                "encoding-date": "2025-02-10"
            },
            "source": "https://flat.io/score/67a26884ad9eb655c27e1bbe-one-note-e5-half?sharingKey=d61fc1be1b3df01d6c52162d81e4d58834ce3f30ad9eb9a49d3f642d0a822b04c929b2ee20aaa2af838b5e3fe39d6200f5d82895241a832fdbe7b01f2cbe7586"
        }
    }
}


function flatJsonToBlockly(flatJson) {
  console.log("Flatjson example: ", flatJson);

  let blocklyJson = {
    "type": "music_piece",
    "message0": "Music Piece",
    "args0": [],
    "output": "music_piece",
    "colour": 160,
    "tooltip": "A music piece",
    "helpUrl": "",
    "children": []
  };

  const part = flatJson["score-partwise"]["part-list"]["score-part"][0]; // Assumes one part (Trumpet)
  const measures = flatJson["score-partwise"]["measure-list"]["score-measure"]; // All measures
  
  // Adding the part name (Trumpet) to blockly structure
  blocklyJson.children.push({
    "type": "instrument",
    "message0": "Instrument: %1",
    "args0": [
      {
        "type": "field_input",
        "name": "INSTRUMENT_NAME",
        "text": part["part-name"]
      }
    ],
    "output": "instrument",
    "colour": 230,
    "tooltip": "The instrument name",
    "helpUrl": ""
  });

  // Loop through all the measures in the part
  measures.forEach((measure, idx) => {
    let measureBlock = {
      "type": "measure",
      "message0": "Measure %1",
      "args0": [
        {
          "type": "field_number",
          "name": "MEASURE_NUMBER",
          "value": idx + 1 // Measure numbers are 1-based
        }
      ],
      "output": "measure",
      "colour": 230,
      "tooltip": "A musical measure",
      "helpUrl": "",
      "children": []
    };

    const measureDetails = flatJson["score-partwise"]["part"][0]["measure"][idx];
    const notes = measureDetails["note"];
    
    notes.forEach(note => {
      let noteBlock = {
        "type": "note",
        "message0": "Note: %1 %2 %3",
        "args0": [
          {
            "type": "field_input",
            "name": "NOTE_PITCH",
            "text": note["pitch"].step + note["pitch"].octave
          },
          {
            "type": "field_number",
            "name": "NOTE_DURATION",
            "value": note["duration"]
          },
          {
            "type": "field_dropdown",
            "name": "NOTE_TYPE",
            "options": [
              ["Whole", "whole"],
              ["Half", "half"],
              ["Quarter", "quarter"]
            ]
          }
        ],
        "output": "note",
        "colour": 160,
        "tooltip": "A musical note",
        "helpUrl": ""
      };

      measureBlock.children.push(noteBlock); // Add the note block to the measure
    });

    blocklyJson.children.push(measureBlock); // Add the measure block to the music piece
  });

  return blocklyJson;
}

export { threeNotes, flatJsonToBlockly };
