function updateFlatJsonNotes(flatJson, newMeasures) {
    console.log("Updating flatJson with newMeasures", flatJson, newMeasures);

    const updatedFlatJson = JSON.parse(JSON.stringify(flatJson));
    const part = updatedFlatJson["score-partwise"].part[0];

    const durationMapping = {
        "whole": "4",
        "half": "3",
        "quarter": "2",
        "eighth": "1"
    };

    const updatedMeasures = [];

    newMeasures.forEach((measureNotes, index) => {
        const newMeasure = {
            "@number": (index + 1).toString(),
            note: []
        };

        measureNotes.forEach(noteData => {
            const newNote = {};

            if (noteData.step === "rest") {
                newNote.rest = {};
                newNote.voice = "1";
                newNote.staff = "1";
                newNote.duration = durationMapping[noteData.duration];
                newNote["$adagio-location"] = { timePos: 0 };
                newNote.type = noteData.duration;
            } else {
                newNote.pitch = {
                    step: noteData.step,
                    octave: noteData.octave
                };
                newNote.voice = "1";
                newNote.staff = "1";
                newNote.duration = durationMapping[noteData.duration];
                newNote["$adagio-location"] = { timePos: 0 };
                newNote.type = noteData.duration;
            }

            newMeasure.note.push(newNote);
        });

        updatedMeasures.push(newMeasure);
    });

    // Replace all measures in the flatJson with the updated list
    part.measure = updatedMeasures;

    console.log("Updated JSON measures check: ", convertFlatJsonToMeasures(updatedFlatJson));
    return updatedFlatJson;
}
